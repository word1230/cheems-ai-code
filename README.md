
# 开发计划

问题： 
- 调用模型会出现速率限制(已解决) 
  - 报错信息： dev.langchain4j.exception.RateLimitException: {"errors":{"message":"Request limit exceeded."，"request_id":"9a8023e0-358e-4514-b7b7-43fb1b26a24d"}}
  -  **解决**： 更换上游，换个api供应商
  

## 扩展功能（已完成）
### 网页截图实现应用封面生成（已完成）
1. 引入selenium库
2. config 配置driver
3. 网页截图到本地
   1. 打开浏览器，访问网页
   2. 截图
   3. 保存到本地
4. 压缩后，保存到腾讯云oss
5. 在应用部署后进行截图，更新数据库


### 下载代码（已完成）
1. 校验
   1. 权限 用户是否用权限下载
   2. 应用是否存在
2. 找到应用原始目录
3. 定义文件过滤器
4. 过滤掉不需要的目录
5. 对目录进行压缩，返回压缩包

### Ai智能选择方案(已完成)

   目前有HTML，MUTI_FILE , VUE_PROJECT 三种 ， 让ai根据复杂度输出一种
   1. 集成一个新的模型 用来做路由选择 
      1. config
      2. 新的提示词
      3. 在AIRouterservice中定义请求 
      4. 新的factory
      5. 新的facade
      6. 在创建应用前调用ai给出方案， 设置到app中


## 可视化修改

## ai工作流

## 系统优化

### redis 做缓存



### vue项目实时预览 


### 存储聊天记录方案 
方案一： mongodb存储聊天记录 + redis获取聊天记录实现记忆 + es实现快速查找（管理员查找，和用户查看）
方案二： postgreSQL+pgvector+redis+对象存储


### 代码存储的优化

方案： 对象存储（代码）+ postgresql(元数据) + docker(预览与部署)


流程：
阶段一： 用户初始化应用并实现预览
   1) 用户输入提示词后，创建应用，存储应用元数据（名称，封面，初始化提示词，代码生成类型，代码的链接，部署标识(是否部署)，部署时间，优先级。。。）到mysql中。
   2) 代码生成完毕后，将用户代码压缩，上传到对象存储中，更新元数据。
   3) 运行一个docker容器，从对象存储获取代码，执行npm install（为容器挂载一个共享的依赖缓存卷。这样，如果多个项目使用相同的依赖，构建速度加快） 和 npm dev ，预览服务将容器的服务信息注册到动态路由网关中（nginx plus/traefik/k8s ingress controller），返回url给前端。
   4) 用户关闭预览，通知后端。预览服务销毁容器，并从代理中注销路由。
   5) 前端通过iframe加载URL，用户看到预览页面。代码修改时，通过文件同步触发容器内的热重载。
阶段二：部署
1) 用户点击部署后，更新元数据，生成一个标识
2) 运行一个docker容器，从对象存储获取代码，打包并构建项目（后续使用ci/cd,GitHub Actions/GitLab CI）
3) 将构建产物(如dist)上传到生产对象存储。上传成功后，调用CDN API刷新缓存。最后，返回该项目的永久域名URL。
4) 销毁容器 